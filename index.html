<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üó°Ô∏è Samuraix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#222222">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Samuraix">
  <style>
    body {
      margin: 0;
      background: linear-gradient(#87CEEB, #4FA3E2);
      overflow: hidden;
      font-family: monospace;
      color: white;
    }
    canvas { 
      display: block; 
      background: #88d;
      image-rendering: pixelated;
    }
    #ui {
      position: absolute;
      top: 5px; left: 5px;
      display: flex;
      gap: 20px;
      font-size: 14px;
      background: rgba(0,0,0,0.4);
      padding: 5px 10px;
      border-radius: 8px;
    }
    .bar {
      height: 10px;
      background: red;
    }
    #player-bar {
      width: 100px;
      background: red;
    }
    #shield-btn {
      position: absolute;
      bottom: 20px; right: 20px;
      padding: 15px;
      border: none;
      border-radius: 50%;
      background: #444;
      color: white;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <canvas id="game" width="480" height="320"></canvas>

  <div id="ui">
    <div>Nivel: <span id="level">1</span></div>
    <div>Vida Player: <span id="pLife">5</span></div>
  </div>
  <button id="shield-btn">üõ°Ô∏è</button>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let level = 1;
    let clouds = Array.from({length:5},()=>({x:Math.random()*480,y:Math.random()*50,s:1+Math.random()*2}));

    const player = {x:50,y:250,w:20,h:20,life:5,speed:3,attacking:false,shield:false};
    let enemies = spawnEnemies(level);
    let boss = null;

    function spawnEnemies(lv){
      let arr=[];
      for(let i=0;i<lv*2;i++){
        arr.push({x:200+Math.random()*200,y:250,w:20,h:20,life:3,attackTimer:0});
      }
      return arr;
    }

    function draw(){
      ctx.clearRect(0,0,480,320);

      // cielo y nubes
      ctx.fillStyle="#4FA3E2";
      ctx.fillRect(0,0,480,320);
      ctx.fillStyle="white";
      clouds.forEach(c=>{
        ctx.fillRect(c.x,c.y,40,20);
        c.x-=c.s*0.2;
        if(c.x<-40) c.x=480;
      });

      // suelo
      ctx.fillStyle="#228B22";
      ctx.fillRect(0,270,480,50);

      // player
      ctx.fillStyle="blue";
      ctx.fillRect(player.x,player.y,player.w,player.h);

      // espada animada
      if(player.attacking){
        ctx.fillStyle="silver";
        ctx.fillRect(player.x+player.w,player.y+5,15,5);
      }

      // enemigos
      enemies.forEach(e=>{
        ctx.fillStyle="red";
        ctx.fillRect(e.x,e.y,e.w,e.h);
        // barra vida
        ctx.fillStyle="green";
        ctx.fillRect(e.x,e.y-5,(e.life/3)*20,3);
      });

      // boss
      if(boss){
        ctx.fillStyle="purple";
        ctx.fillRect(boss.x,boss.y,boss.w,boss.h);
        ctx.fillStyle="green";
        ctx.fillRect(boss.x,boss.y-5,(boss.life/10)*40,4);
      }
    }

    function update(){
      // mover enemigos
      enemies.forEach(e=>{
        e.x-=1;
        if(e.x<0) e.x=480;
        // colisi√≥n con player
        if(col(player,e)){
          if(!player.shield){
            player.life--;
            document.getElementById("pLife").innerText=player.life;
          }
        }
        // ataque player
        if(player.attacking && e.x<player.x+40 && e.x>player.x && e.y===player.y){
          e.life--;
        }
      });
      enemies=enemies.filter(e=>e.life>0);

      // pasar de nivel
      if(enemies.length===0 && !boss){
        if(level<3){
          level++;
          document.getElementById("level").innerText=level;
          enemies=spawnEnemies(level);
        }else{
          // spawn boss
          boss={x:400,y:250,w:40,h:40,life:10,timer:0};
        }
      }

      // boss logic
      if(boss){
        boss.timer++;
        if(boss.timer>180){ // cada 3s a 60fps
          boss.timer=0;
          if(col(player,boss) && !player.shield){
            player.life-=2;
            document.getElementById("pLife").innerText=player.life;
          }
        }
        if(player.attacking && col(player,boss)){
          boss.life--;
        }
        if(boss.life<=0) boss=null;
      }
    }

    function col(a,b){
      return a.x<a.x+a.w && a.x+b.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;
    }

    function loop(){
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // controles
    window.addEventListener("keydown",e=>{
      if(e.key==="ArrowRight") player.x+=player.speed;
      if(e.key==="ArrowLeft") player.x-=player.speed;
      if(e.key===" ") player.attacking=true;
    });
    window.addEventListener("keyup",e=>{
      if(e.key===" ") player.attacking=false;
    });

    document.getElementById("shield-btn").addEventListener("mousedown",()=>player.shield=true);
    document.getElementById("shield-btn").addEventListener("mouseup",()=>player.shield=false);

    loop();
  </script>
</body>
</html>